{
   "_id": "_design/worldcat",
   "_rev": "2-a00dc2f7e07f0bbd7c9d5e045692a595",
   "language": "javascript",
   "views": {
       "nt": {
           "map": "/*\n\nShared code\n\n\n*/\n//----------------------------------------------------------------------------------------\n// Store a triple with optional language code\nfunction triple(subject, predicate, object, language) {\n  var triple = [];\n  triple[0] = subject;\n  triple[1] = predicate;\n  triple[2] = object;\n\n  if (typeof language === 'undefined') {} else {\n    triple[3] = language;\n  }\n\n  return triple;\n}\n\n//----------------------------------------------------------------------------------------\n// Store a quad (not used at present)\nfunction quad(subject, predicate, object, context) {\n  var triple = [];\n  triple[0] = $subject;\n  triple[1] = $predicate;\n  triple[2] = $object;\n  triple[3] = $context;\n\n  return triple;\n}\n\n//----------------------------------------------------------------------------------------\n// Enclose triple in suitable wrapping for HTML display or triplet output\nfunction wrap(s, html) {\n  if (s.match(/^(http|urn|_:)/)) {\n    if (html) {\n      s = '&lt;' + s + '&gt;';\n    } else {\n      s = '<' + s + '>';\n    }\n  } else {\n    s = '\"' + s.replace(/\"/g, '\\\\\"') + '\"';\n  }\n  return s;\n}\n\n//----------------------------------------------------------------------------------------\n// https://css-tricks.com/snippets/javascript/htmlentities-for-javascript/\nfunction htmlEntities(str) {\n  return String(str).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\"/g, '&quot;');\n}\n\n//----------------------------------------------------------------------------------------\nfunction output(doc, triples) {\n    // CouchDB\n    for (var i in triples) {\n      var s = 0;\n      var p = 1;\n      var o = 2;\n      emit(doc._id, wrap(triples[i][s], false) + ' ' + wrap(triples[i][p], false) + ' ' + wrap(triples[i][o], false) + ' .');\n    }\n}\n\nfunction message(doc) {\n  var triples = [];\n\n\n\t  var cluster_id = '';\n\t   \n\t  if (doc.message.issnl) {\n\t\t cluster_id = 'http://www.worldcat.org/issn/' + doc.message.issnl;\n\t  } else {\n\t\t cluster_id = 'http://www.worldcat.org/issn/' + doc.message.issn;\n\t }          \n\n\t   // defaults\n\t  triples.push(triple(cluster_id,\n\t\t 'http://www.w3.org/1999/02/22-rdf-syntax-ns#type',\n\t\t 'http://schema.org/Periodical'));\n\n\t  triples.push(triple(cluster_id,\n\t\t 'http://www.w3.org/1999/02/22-rdf-syntax-ns#type',\n\t\t 'http://schema.org/ProductModel'));\n\n \n for (var i in doc.message) {\n    switch (i) {\n      case 'issn':\n          triples.push(triple(cluster_id,\n            'http://purl.org/dc/terms/identifier',\n             'http://www.worldcat.org/issn/' + doc.message[i]));\n             \n\t\t\ttriples.push(triple(cluster_id,\n             'http://schema.org/issn',\n             doc.message[i]));   \n        break;\n        \n      case 'title':          \n          triples.push(triple(cluster_id,\n             'http://schema.org/name',\n             doc.message[i]));\n         break;\n\n      case 'publisher':          \n          triples.push(triple(cluster_id,\n             'http://schema.org/publisher',\n             doc.message[i]));\n         break;\n \n      case 'rawcoverage':          \n          triples.push(triple(cluster_id,\n             'http://schema.org/temporalCoverage',\n             doc.message[i]));\n         break;\n\n      case 'rssurl':          \n          triples.push(triple(cluster_id,\n             'http://schema.org/supportingData',\n             doc.message[i]));\n             \n            triples.push(triple(doc.message[i],\n\t\t\t\t'http://www.w3.org/1999/02/22-rdf-syntax-ns#type',\n\t\t\t\t'http://schema.org/DataFeed'));             \n         break;\n         \n       // From GoodRelations in schema\n       case 'preceding':\n          for (var j in doc.message[i]) {\n          \n            triples.push(triple(cluster_id,\n\t\t\t\t'http://schema.org/successorOf',\n\t\t\t\t'http://www.worldcat.org/issn/' + doc.message[i][j]\n\t\t\t\t));             \n          }\n          break;\n          \n       case 'succeeding':\n          for (var j in doc.message[i]) {\n          \n            triples.push(triple(cluster_id,\n\t\t\t\t'http://schema.org/predecessorOf',\n\t\t\t\t'http://www.worldcat.org/issn/' + doc.message[i][j]\n\t\t\t\t));\n\t\t\t\t           \n          \n          }\n          break;\n          \n\n       default:\n         break; \n     }\n  }\n\n  output(doc, triples);\n\n}\n\nfunction(doc) {\n  if (doc['message-format']) {\n    if ((doc['message-format'] == 'application/json') \n      && (doc._id.match(/worldcat.org/))) {\n      message(doc);\n    }\n  }\n}"
       },
       "modified": {
           "map": "function(doc) {\n  if (doc['message-format']) {\n    if ((doc['message-format'] == 'application/json') \n      && (doc._id.match(/worldcat.org/))) {\n      if (doc.message) {\n        emit(doc['message-modified'], doc._id);\n     }\n    }\n  }\n}"
       }
   }
}