<html>
	<head>
		<title>GENBANK to n-triples</title>
		<meta charset="UTF-8"/>
		<script src="jquery.js"></script>
		<script src="jsonld.js"></script>
		<script src="shared.js"></script>
		<style>
		td { border: 1px solid red; }
		</style>
	</head>
<body>

<h1>GENBANK to n-triples</h1>

<div>
	<div style="width:100%;height:auto;">
		<h2>JSON</h2>
<!--
Palm with images, holotype
described in Phytotaxa 10.11646/phytotaxa.28.1.2
{"key":912550916,"datasetKey":"cd6e21c8-9e8a-493a-8a76-fbf7862069e5","publishingOrgKey":"061b4f20-f241-11da-a328-b8a03c50a862","publishingCountry":"GB","protocol":"DWC_ARCHIVE","lastCrawled":"2016-09-13T07:33:54.352+0000","lastParsed":"2016-09-13T07:33:54.596+0000","crawlId":57,"extensions":{},"basisOfRecord":"PRESERVED_SPECIMEN","taxonKey":7375421,"kingdomKey":6,"phylumKey":7707728,"classKey":196,"orderKey":552,"familyKey":7681,"genusKey":2736518,"speciesKey":7375421,"scientificName":"Areca dransfieldii Heatubun","kingdom":"Plantae","phylum":"Tracheophyta","order":"Arecales","family":"Arecaceae","genus":"Areca","species":"Areca dransfieldii","genericName":"Areca","specificEpithet":"dransfieldii","taxonRank":"SPECIES","dateIdentified":"2011-06-06T00:00:00.000+0000","decimalLongitude":114.03,"decimalLatitude":4.2,"coordinateUncertaintyInMeters":0.2,"elevation":147.0,"year":2008,"month":4,"day":1,"eventDate":"2008-04-01T00:00:00.000+0000","typeStatus":"HOLOTYPE","issues":["GEODETIC_DATUM_ASSUMED_WGS84"],"lastInterpreted":"2016-09-13T07:43:49.157+0000","license":"http://creativecommons.org/licenses/by/4.0/legalcode","identifiers":[],"media":[{"type":"StillImage","format":"image/jpeg","identifier":"http://www.kew.org/herbcatimg/367322.jpg","license":"Â© The Board of Trustees of the Royal Botanic Gardens, Kew."}],"facts":[],"relations":[],"geodeticDatum":"WGS84","class":"Liliopsida","countryCode":"MY","country":"Malaysia","recordNumber":"CH901","identifier":"K000707028","higherGeography":"Sarawak","georeferenceProtocol":"label","locality":"Sarawak, Miri, Lambir National Park, patch from waterfall.","eventRemarks":"Clustering, small palm with stiltroots and aerial branching, tall to 2 - 3 m high, stem 2.5 cm in diam., internodes 3 - 4 cm long; 7 leaves in the crown, crown shaft 35 cm long, leaf sheath 20 cm long. leaf 158 -165 cm long, petiole 70 - 81 cm long, leafl","collectionCode":"Herbarium","gbifID":"912550916","occurrenceID":"http://specimens.kew.org/herbarium/K000707028","catalogNumber":"K000707028","recordedBy":"Rebi, S.; Heatubun, C.D.","institutionCode":"K","higherClassification":"ARECACEAE,ARECACEAE","identifiedBy":"Heatubun, C.D."}
-->		

<!-- JSON for data object goes below -->

<!--
{"message":{"sequence":{"accession":"HM067338","accession_version":"HM067338.1","gi":"298571189"},"identification":{"taxonomy":["Eukaryota","Metazoa","Chordata","Craniata","Vertebrata","Euteleostomi","Amphibia","Batrachia","Anura","Neobatrachia","Ranoidea","Dicroglossidae","Dicroglossinae","Limnonectes"],"organism":"Limnonectes cf. kuhlii 'lineage 9'","taxonID":"797111"},"sample":{"otherCatalogNumbers":["CAS 235132"],"institutionCode":"CAS","catalogNumber":"235132","note":"lineage 9"},"links":["http:\/\/www.ncbi.nlm.nih.gov\/Taxonomy\/Browser\/wwwtax.cgi?id=797111","http:\/\/www.ncbi.nlm.nih.gov\/pubmed\/20385247"],"update_date":["2010","8","23"],"create_date":["2010","7","9"],"definition":"Limnonectes cf. kuhlii 'lineage 9' voucher CAS 235132 12S ribosomal RNA, partial sequence; tRNA-Val, complete sequence; and 16S ribosomal RNA gene, partial sequence; mitochondrial","locality":{"country":"Myanmar","locality":"Chin State, Min Dat Dist., Twei Pa Lan village"},"references":[{"pmid":20385247,"doi":"10.1016\/j.ympev.2010.04.004"}]}}
{"message":{"sequence":{"accession":"KC860804","accession_version":"KC860804.1","gi":"511773069","gene":["COI"],"product":["cytochrome oxidase subunit 1"]},"identification":{"taxonomy":["Eukaryota","Metazoa","Chordata","Craniata","Vertebrata","Euteleostomi","Actinopterygii","Neopterygii","Teleostei","Neoteleostei","Acanthomorphata","Ovalentaria","Blenniimorphae","Blenniiformes","Blennioidei","Tripterygiidae","Tripterygiinae","Enneanectes"],"organism":"Enneanectes boehlkei","taxonID":"722436","identifiedBy":"Benjamin Victor"},"sample":{"organelle":"mitochondrion","otherCatalogNumbers":["sb92enn92"]},"links":["http:\/\/bins.boldsystems.org\/index.php\/Public_RecordView?processid=LIDMA626-11","http:\/\/www.ncbi.nlm.nih.gov\/Taxonomy\/Browser\/wwwtax.cgi?id=722436"],"update_date":["2013","9","26"],"create_date":["2013","9","26"],"definition":"Enneanectes boehlkei voucher sb92enn92 cytochrome oxidase subunit 1 (COI) gene, partial cds; mitochondrial","locality":{"country":"Panama","decimalLatitude":"9.55","decimalLongitude":-78.96,"locality":"Kuna Yala, San Blas Islands, near Porvenir"},"event":{"verbatimEventDate":"01-Apr-1992","eventDate":["1992","4","1"],"collected_by":"Laura Guttierez"},"references":[{"title":"The Caribbean Roughhead Triplefin (Enneanectes boehlkei): DNA barcodingreveals a complex of four West Indian sympatric cryptic species (Teleostei: Blennioidei: Tripterygiidae)","bibliographicCitation":"J Ocean Sci Found 7, 44-73 (2013)","journal":"J Ocean Sci Found","volume":"7","pageStart":"44","pageEnd":"73","year":"2013","author":[{"family":"Victor","given":"B."}]}]}}
-->
			<textarea id="json" style="width:100%;background-color:#224FBC;color:#FFFF66;" rows="20">

{"message":{"sequence":{"accession":"KC860804","accession_version":"KC860804.1","gi":"511773069","gene":["COI"],"product":["cytochrome oxidase subunit 1"]},"identification":{"taxonomy":["Eukaryota","Metazoa","Chordata","Craniata","Vertebrata","Euteleostomi","Actinopterygii","Neopterygii","Teleostei","Neoteleostei","Acanthomorphata","Ovalentaria","Blenniimorphae","Blenniiformes","Blennioidei","Tripterygiidae","Tripterygiinae","Enneanectes"],"organism":"Enneanectes boehlkei","taxonID":"722436","identifiedBy":"Benjamin Victor"},"sample":{"organelle":"mitochondrion","otherCatalogNumbers":["sb92enn92"]},"links":["http:\/\/bins.boldsystems.org\/index.php\/Public_RecordView?processid=LIDMA626-11","http:\/\/www.ncbi.nlm.nih.gov\/Taxonomy\/Browser\/wwwtax.cgi?id=722436"],"update_date":["2013","9","26"],"create_date":["2013","9","26"],"definition":"Enneanectes boehlkei voucher sb92enn92 cytochrome oxidase subunit 1 (COI) gene, partial cds; mitochondrial","locality":{"country":"Panama","decimalLatitude":"9.55","decimalLongitude":-78.96,"locality":"Kuna Yala, San Blas Islands, near Porvenir"},"event":{"verbatimEventDate":"01-Apr-1992","eventDate":["1992","4","1"],"collected_by":"Laura Guttierez"},"references":[{"title":"The Caribbean Roughhead Triplefin (Enneanectes boehlkei): DNA barcodingreveals a complex of four West Indian sympatric cryptic species (Teleostei: Blennioidei: Tripterygiidae)","bibliographicCitation":"J Ocean Sci Found 7, 44-73 (2013)","journal":"J Ocean Sci Found","volume":"7","pageStart":"44","pageEnd":"73","year":"2013","author":[{"family":"Victor","given":"B."}]}]}}
			</textarea>
			<br />
			<button onclick="convert()">Convert</button>
		
	
	</div>
	<div style="clear:both;"></div>
	
	<div style="width:100%;">
		<h2>Triples</h2>
		<div id="output" style="width:100%;color:#222;"></div>
		<div id="jsonld" style="width:100%;white-space:pre;background-color:#333;color:white;"></div>
	</div>

</div>

		<script>
		

// geohash.js
// Geohash library for Javascript
// (c) 2008 David Troy
// Distributed under the MIT License

BITS = [16, 8, 4, 2, 1];

BASE32 = 											   "0123456789bcdefghjkmnpqrstuvwxyz";
NEIGHBORS = { right  : { even :  "bc01fg45238967deuvhjyznpkmstqrwx" },
							left   : { even :  "238967debc01fg45kmstqrwxuvhjyznp" },
							top    : { even :  "p0r21436x8zb9dcf5h7kjnmqesgutwvy" },
							bottom : { even :  "14365h7k9dcfesgujnmqp0r2twvyx8zb" } };
BORDERS   = { right  : { even : "bcfguvyz" },
							left   : { even : "0145hjnp" },
							top    : { even : "prxz" },
							bottom : { even : "028b" } };

NEIGHBORS.bottom.odd = NEIGHBORS.left.even;
NEIGHBORS.top.odd = NEIGHBORS.right.even;
NEIGHBORS.left.odd = NEIGHBORS.bottom.even;
NEIGHBORS.right.odd = NEIGHBORS.top.even;

BORDERS.bottom.odd = BORDERS.left.even;
BORDERS.top.odd = BORDERS.right.even;
BORDERS.left.odd = BORDERS.bottom.even;
BORDERS.right.odd = BORDERS.top.even;

function refine_interval(interval, cd, mask) {
	if (cd&mask)
		interval[0] = (interval[0] + interval[1])/2;
  else
		interval[1] = (interval[0] + interval[1])/2;
}

function calculateAdjacent(srcHash, dir) {
	srcHash = srcHash.toLowerCase();
	var lastChr = srcHash.charAt(srcHash.length-1);
	var type = (srcHash.length % 2) ? 'odd' : 'even';
	var base = srcHash.substring(0,srcHash.length-1);
	if (BORDERS[dir][type].indexOf(lastChr)!=-1)
		base = calculateAdjacent(base, dir);
	return base + BASE32[NEIGHBORS[dir][type].indexOf(lastChr)];
}

function decodeGeoHash(geohash) {
	var is_even = 1;
	var lat = []; var lon = [];
	lat[0] = -90.0;  lat[1] = 90.0;
	lon[0] = -180.0; lon[1] = 180.0;
	lat_err = 90.0;  lon_err = 180.0;
	
	for (i=0; i<geohash.length; i++) {
		c = geohash[i];
		cd = BASE32.indexOf(c);
		for (j=0; j<5; j++) {
			mask = BITS[j];
			if (is_even) {
				lon_err /= 2;
				refine_interval(lon, cd, mask);
			} else {
				lat_err /= 2;
				refine_interval(lat, cd, mask);
			}
			is_even = !is_even;
		}
	}
	lat[2] = (lat[0] + lat[1])/2;
	lon[2] = (lon[0] + lon[1])/2;

	return { latitude: lat, longitude: lon};
}

function encodeGeoHash(latitude, longitude) {
	var is_even=1;
	var i=0;
	var lat = []; var lon = [];
	var bit=0;
	var ch=0;
	var precision = 12;
	geohash = "";

	lat[0] = -90.0;  lat[1] = 90.0;
	lon[0] = -180.0; lon[1] = 180.0;
	
	while (geohash.length < precision) {
	  if (is_even) {
			mid = (lon[0] + lon[1]) / 2;
	    if (longitude > mid) {
				ch |= BITS[bit];
				lon[0] = mid;
	    } else
				lon[1] = mid;
	  } else {
			mid = (lat[0] + lat[1]) / 2;
	    if (latitude > mid) {
				ch |= BITS[bit];
				lat[0] = mid;
	    } else
				lat[1] = mid;
	  }

		is_even = !is_even;
	  if (bit < 4)
			bit++;
	  else {
			geohash += BASE32[ch];
			bit = 0;
			ch = 0;
	  }
	}
	return geohash;
}



		
function genbank_data(doc) {
  var triples = [];



  var cluster_id = 'http://eutils.ncbi.nlm.nih.gov/entrez/eutils/efetch.fcgi?' 
  	+ 'db=nucleotide'
  	+ 'id=' + doc.message.sequence.accession
  	+ '&retype=gb'
  	+ '&retmode=xml';
  
  var locality_id = '';
  var event_id = '';
  var identification_id = '';
  var sequence_id = 'http://identifiers.org/insdc/' + doc.message.sequence.accession;    var sequence_id = 'http://identifiers.org/insdc/' + doc.message.sequence.accession;
  var item_id = 'http://www.ncbi.nlm.nih.gov/nuccore/' + doc.message.sequence.accession;
  var identification_id = item_id + '#identification';  
  
  // Occurrence ID may be supplied by data provider, use that where possible,
  // otherwise default to GBIF occurrence number
  var occurrence_id = '';
 
  if (occurrence_id == '') {
    occurrence_id = item_id + '#occurrence';
  }
 
  triples.push(triple(occurrence_id,
			      'http://www.w3.org/1999/02/22-rdf-syntax-ns#type',
                  'http://rs.tdwg.org/dwc/terms/Occurrence'));				
  
  triples.push(triple(cluster_id,
				'http://schema.org/item',
				item_id));  
				
  triples.push(triple(item_id,
				'http://rs.tdwg.org/dwc/terms/occurrenceID',
				occurrence_id)); 
				
				
  // record level
  var date = doc.message.create_date.join('-');
  date = date.replace(/-([0-9])\b/g, "-0$1");
  
  triples.push(triple(cluster_id,
				'http://schema.org/dateCreated',
				date));  
				
  date = doc.message.update_date.join('-');
  date = date.replace(/-([0-9])\b/g, "-0$1");
				
				
  triples.push(triple(cluster_id,
				'http://schema.org/dateModified',
				date));  
				
  // item level
  if (doc.message.definition) {
  triples.push(triple(item_id,
				'http://schema.org/description',
				doc.message.definition));    
  }			
  if (doc.message.definition) {
  triples.push(triple(item_id,
				'http://schema.org/version',
				doc.message.sequence.accession_version));    
  }			
  
  if (doc.message.keywords) {
	  for (var i in doc.message.keywords) {
		triples.push(triple(item_id,
			'http://schema.org/about',
			String(doc.message.keywords[i]) ));
		}
	}  

  // identification
			triples.push(triple(item_id,
		  	'http://rs.tdwg.org/dwc/terms/identificationID',
		  	identification_id ));		  			
  
 			triples.push(triple(identification_id,
		  	'http://rs.tdwg.org/dwc/terms/taxonID',
		  	'http://identifiers.org/taxonomy/' + doc.message.identification.taxonID));

 			triples.push(triple(identification_id,
		  	'http://rs.tdwg.org/dwc/terms/scientificName',
		  	doc.message.identification.organism));

			triples.push(triple(identification_id,
		  	'http://rs.tdwg.org/dwc/terms/higherClassification',
		  	doc.message.identification.taxonomy.join('|')));
		  	
		  	if (doc.message.identification.identifiedBy) {
 				triples.push(triple(identification_id,
		  		'http://rs.tdwg.org/dwc/terms/identifiedBy',
		  		doc.message.identification.identifiedBy));
		  	
		  	
		  	}
		  	
  // occurrence 
  if (doc.message.sample) {
    if (doc.message.sample.institutionCode) {
  		triples.push(triple(occurrence_id,
		  	'http://rs.tdwg.org/dwc/terms/institutionCode',
		  	String(doc.message.sample.institutionCode) ));
    }
    if (doc.message.sample.collectionCode) {
  		triples.push(triple(occurrence_id,
		  	'http://rs.tdwg.org/dwc/terms/collectionCode',
		  	String(doc.message.sample.collectionCode) ));
    }
    if (doc.message.sample.catalogNumber) {
  		triples.push(triple(occurrence_id,
		  	'http://rs.tdwg.org/dwc/terms/catalogNumber',
		  	String(doc.message.sample.catalogNumber) ));
    }

    if (doc.message.sample.otherCatalogNumbers) {
		for (var j in doc.message.sample.otherCatalogNumbers) {
			triples.push(triple(occurrence_id,
		  		'http://rs.tdwg.org/dwc/terms/otherCatalogNumbers',
		  		String(doc.message.sample.otherCatalogNumbers[j]) ));
			triples.push(triple(occurrence_id,
		  		'http://schema.org/alternateName',
		  		String(doc.message.sample.otherCatalogNumbers[j]) ));
		
		}


	}  
	
	  // host (item-level)
	  if (doc.message.sample.host) {

	   triples.push(triple(item_id,
		'http://rs.tdwg.org/dwc/terms/associatedTaxa',
		String(doc.message.sample.host)));
	 }
		
  
  
  }  	
		  	

  
  
  // sequence
                   triples.push(triple(item_id,
		  			'http://rs.tdwg.org/dwc/terms/associatedSequences',
		  			'http://identifiers.org/insdc/' + doc.message.sequence.accession));
		  			
		  			if (doc.message.sequence.gene) {
		  			  for (var i in doc.message.sequence.gene) {
		  			    triples.push(triple(sequence_id,
		  					'http://schema.org/about',
		  					String(doc.message.sequence.gene[i]) ));
		  				}
		  			}

		  			if (doc.message.sequence.product) {
		  			  for (var i in doc.message.sequence.product) {
		  			    triples.push(triple(sequence_id,
		  					'http://schema.org/about',
		  					String(doc.message.sequence.product[i]) ));
		  				}
		  			}
		  			
		  			
	  		
		  			
 // references
 
   if (doc.message.references) {
      var n =  doc.message.references.length;
      for (var i = 0; i < n; i++) {
			var reference_id = '';
			
			if (doc.message.references[i].pmid) {
				reference_id = 'http://identifiers.org/pubmed/' + doc.message.references[i].pmid;
			}
			if (doc.message.references[i].doi) {
				reference_id = 'http://identifiers.org/doi/' + doc.message.references[i].doi;
			}
			
			// We have a GUID
			if (reference_id != '') {
				triples.push(triple(item_id,
		  			'http://rs.tdwg.org/dwc/terms/associatedReferences',
		  			reference_id ));
		  	} else {
		  	    // Store actual reference
		  		reference_id = item_id + '#reference_' + (i + 1);
		  		
					triples.push(triple(item_id,
		  			'http://rs.tdwg.org/dwc/terms/associatedReferences',
		  			reference_id ));		  		
		  		
				triples.push(triple(reference_id,
				  'http://www.w3.org/1999/02/22-rdf-syntax-ns#type',
				  'http://schema.org/CreativeWork'));	  		
		  		
		  		if (doc.message.references[i].title) {
		  			triples.push(triple(reference_id,
		  				'http://schema.org/name',
		  				doc.message.references[i].title ));		  		
		  		}
		  		if (doc.message.references[i].bibliographicCitation) {
		  			triples.push(triple(reference_id,
		  				'http://purl.org/dc/terms/bibliographicCitation',
		  				doc.message.references[i].bibliographicCitation ));		  		
		  		}
		  		
		  		if (doc.message.references[i].author) {
		  			
					var n = doc.message.references[i].author.length;
					for (var j = 0; j < n; j++) {
			 			 var author_id = reference_id + '/author_' + (j + 1);
			 			 
							triples.push(triple(reference_id,
								'http://schema.org/author',
								author_id));			 			 
			 			 
							triples.push(triple(author_id,
								'http://www.w3.org/1999/02/22-rdf-syntax-ns#type',
								'http://schema.org/Person'));	
								
							var name = '';
							  if (doc.message.references[i].author[j].given) {
								triples.push(triple(author_id,
								  'http://schema.org/givenName', // ?
								  doc.message.references[i].author[j].given));

								name += doc.message.references[i].author[j].given;
							  }										 			 
							  if (doc.message.references[i].author[j].family) {
								triples.push(triple(author_id,
								  'http://schema.org/familyName', // ?
								  doc.message.references[i].author[j].family));

								name += ' ' + doc.message.references[i].author[j].family;
							  }										 			 

							  if (name != '') {
								triples.push(triple(author_id,
								  'http://schema.org/name', // ?
								  name));
							  }										 			 

		 			 
			 			 
			 			 
			 			 
			 			 
			 			 
			 		}
			  
		  			
		  		
		  		
		  		
		  		}
		  		
		  		
		  		
		  		
		  		if (doc.message.references[i].journal) {
		  		
					triples.push(triple(reference_id,
				  	'http://www.w3.org/1999/02/22-rdf-syntax-ns#type',
				 	 'http://schema.org/ScholarlyArticle'));		  		
		  		
		  			triples.push(triple(reference_id,
		  				'http://prismstandard.org/namespaces/basic/2.1/publicationName',
		  				doc.message.references[i].journal ));		  		
		  		}
		  		

		  		if (doc.message.references[i].volume) {
		  			triples.push(triple(reference_id,
		  				'http://schema.org/volumeNumber',
		  				String(doc.message.references[i].volume) ));		  		
		  		}
		  		if (doc.message.references[i].issue) {
		  			triples.push(triple(reference_id,
		  				'http://schema.org/issueNumber',
		  				String(doc.message.references[i].issue) ));		  		
		  		}
		  		if (doc.message.references[i].pageStart) {
		  			triples.push(triple(reference_id,
		  				'http://schema.org/pageStart',
		  				String(doc.message.references[i].pageStart) ));		  		
		  		}
		  		if (doc.message.references[i].pageEnd) {
		  			triples.push(triple(reference_id,
		  				'http://schema.org/pageEnd',
		  				String(doc.message.references[i].pageEnd) ));		  		
		  		}
		  		if (doc.message.references[i].year) {
		  			triples.push(triple(reference_id,
		  				'http://schema.org/datePublished',
		  				String(doc.message.references[i].year) ));		  		
		  		}
		  	
		  	
		  	
		  	}
      
      }
   }


 
 
  
  // event
  if (doc.message.event) {
    for (var i in doc.message.event) {
      switch (i) {
 		case 'verbatimEventDate':
 		case 'eventDate':
 		
		  if (event_id == '') {
				// b-node
			  event_id = item_id + '#event';
			  
			  if (doc.message.eventID) {
                 if (doc.message.eventID.match(/^(http[s]?|urn)/)) {
                  event_id = doc.message.eventID;
                 }
              }			
			  
			triples.push(triple(event_id,
			      'http://www.w3.org/1999/02/22-rdf-syntax-ns#type',
                  'http://rs.tdwg.org/dwc/terms/Event'));	
                  
            // link to cluster
			triples.push(triple(item_id,
		  	'http://rs.tdwg.org/dwc/terms/eventID',
		  	event_id ));        	  
		  }
		  
		  switch (i) {
		    case 'verbatimEventDate':
				triples.push(triple(event_id,
		  			'http://rs.tdwg.org/dwc/terms/verbatimEventDate',
		  			String(doc.message.event[i]) ));	
		  		break;
		  		
		  	case 'eventDate':
		  	   if (doc.message.event[i].length == 3) {
		  	   		triples.push(triple(event_id,
		  				'http://rs.tdwg.org/dwc/terms/day',
		  				String(doc.message.event[i][2]) ));
		  	    }
		  		
		  	   if (doc.message.event[i].length >= 2) {
		  	   		triples.push(triple(event_id,
		  				'http://rs.tdwg.org/dwc/terms/month',
		  				String(doc.message.event[i][1]) ));
		  	    }
		  	   if (doc.message.event[i].length >= 1) {
		  	   		triples.push(triple(event_id,
		  				'http://rs.tdwg.org/dwc/terms/year',
		  				String(doc.message.event[i][0]) ));
		  	    }
		  	    date = doc.message.event[i].join('-');
		  	    date = date.replace(/-([0-9])\b/g, "-0$1");
		  	    
		  	    triples.push(triple(event_id,
		  				'http://rs.tdwg.org/dwc/terms/eventDate',
		  				date ));
		  	    
		  		break;

             default:
               break;
          }		  
		  
		  
		  break;
		  
		default:
		  break;
		}
	}
 }	
  
  // locality
  if (doc.message.locality) {
    for (var i in doc.message.locality) {
      switch (i) {
  		// Darwin Core locality-----------------------------------------------------------
		case 'country':
		case 'decimalLatitude':
		case 'decimalLongitude':
		case 'locality':
		
		// b-node (maybe with global identifer)
		if (locality_id == '') {
		   var geohash = '';
		   
			  locality_id = item_id + '#locality';
			  if (doc.message.locality.decimalLatitude && doc.message.locality.decimalLongitude) {
			    geohash = encodeGeoHash(doc.message.locality.decimalLatitude , doc.message.locality.decimalLongitude);
				locality_id = 'http://geohash.org/' + geohash;
			  }		
			  
			 // types
			triples.push(triple(locality_id,
			      'http://www.w3.org/1999/02/22-rdf-syntax-ns#type',
                  'http://purl.org/dc/terms/Location'));

			triples.push(triple(locality_id,
			      'http://www.w3.org/1999/02/22-rdf-syntax-ns#type',
                  'http://schema.org/Place'));
                  
            // link to cluster
		triples.push(triple(item_id,
		  'http://rs.tdwg.org/dwc/terms/locationID',
		  locality_id ));
            
                  
            // Store the geohash
            if (geohash != '') {
			   triples.push(triple(locality_id,
			      'http://www.w3.org/ns/locn#geometry',
                  'http://geohash.org/' + geohash));
            }
            
			  if (doc.message.locality.decimalLatitude && doc.message.locality.decimalLongitude) {
			  
			    // map
			    var mapUrl = 'http://www.openstreetmap.org/'
			     + '?mlat=' + doc.message.locality.decimalLatitude 
			     + '&mlon=' + doc.message.locality.decimalLongitude
			     + '&zoom=8';
			     
			  triples.push(triple(locality_id,
			      'http://schema.org/hasMap',
                  mapUrl));
 			     
			     			  
			    // geo
			    var geo_id = locality_id + '/geo';
			    
			  triples.push(triple(locality_id,
			      'http://schema.org/geo',
                  geo_id));
 
 			  triples.push(triple(geo_id,
			       'http://www.w3.org/1999/02/22-rdf-syntax-ns#type',
                  'http://schema.org/GeoCoordinates'));
 			  triples.push(triple(geo_id,
			       'http://www.w3.org/1999/02/22-rdf-syntax-ns#type',
                  'http://schema.org/GeoCoordinates'));
 			  triples.push(triple(geo_id,
			       'http://schema.org/latitude',
                  String(doc.message.locality.decimalLatitude)));
 			  triples.push(triple(geo_id,
			       'http://schema.org/longitude',
                  String(doc.message.locality.decimalLongitude)));
            
            }      
                  		  
		 }
		triples.push(triple(locality_id,
		  'http://rs.tdwg.org/dwc/terms/' + i,
		  String(doc.message.locality[i]) ));
		break;  
		
	 default:
	   break;
	   }
	}
 }

 
  


  // defaults
  triples.push(triple(cluster_id,
    'http://www.w3.org/1999/02/22-rdf-syntax-ns#type',
    'http://schema.org/DataFeedItem'));

  output(doc, triples);

}
		
			function convert() {
				var jsonld = $('#json').val();
				var doc = JSON.parse(jsonld);
				genbank_data(doc);
				
			
			}
		</script>


</body>
</html>